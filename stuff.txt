# Proposal Recipe Fixes Summary

## Problem
The Proposal recipe had multiple validation errors preventing the app from initializing during login.

## Errors Fixed

### Error 1: URC-ERECI19 - Invalid optional idHash fields
**Location**: `main/recipes/proposal-recipes.ts:84-91`

**Problem**: When using `isId: true` with `optional: true`, you cannot specify an explicit `itemtype`. ONE.core infers the type as `idHash` automatically.

**Fix**:
```typescript
// ❌ BEFORE (lines 84-86)
{
    itemprop: 'pastSubject',
    itemtype: { type: 'idHash' },  // ← Remove this!
    isId: true
}

// ✅ AFTER
{
    itemprop: 'pastSubject',
    isId: true // Part of deterministic ID (idHash type inferred)
}
```

Same fix applied to `currentSubject` field (lines 89-91).

### Error 2: URC-ERECI31 - Missing array value type
**Location**: `main/recipes/proposal-recipes.ts:93-95`

**Problem**: Arrays in ONE.core recipes must specify the type of their elements using the `value` property.

**Fix**:
```typescript
// ❌ BEFORE
{
    itemprop: 'matchedKeywords',
    itemtype: { type: 'array' } // Missing value type!
}

// ✅ AFTER
{
    itemprop: 'matchedKeywords',
    itemtype: { type: 'array', value: { type: 'string' } }
}
```

### Error 3: URC-ERECI19 - ProposalInteractionResponse `plan` field
**Location**: `main/recipes/proposal-recipes.ts:179-182`

**Problem**: When using `isId: true`, you cannot specify an explicit `itemtype` - ONE.core infers the type automatically.

**Fix**:
```typescript
// ❌ BEFORE
{
    itemprop: 'plan',
    itemtype: { type: 'idHash' },  // ← Remove this!
    isId: true
}

// ✅ AFTER
{
    itemprop: 'plan',
    isId: true // One response per plan (idHash type inferred)
}
```

## Recipe Validation Rules

### Rule 1: isId → No explicit itemtype
When using `isId: true` (with or without `optional: true`):
- ✅ DO: Let ONE.core infer the `idHash` type
- ❌ DON'T: Specify `itemtype: { type: 'idHash' }`

### Rule 2: Arrays must specify element type
When using `type: 'array'`:
- ✅ DO: Add `value: { type: 'string' }` (or appropriate type)
- ❌ DON'T: Use bare `{ type: 'array' }`

## Build & Test
1. Rebuild: `npm run build:main`
2. Restart: `npm run electron`
3. Verify: App starts, waits for login, no recipe errors in logs

## Status
✅ **FIXED** - All recipe errors resolved. App now starts successfully without recipe validation errors.
